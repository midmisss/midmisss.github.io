<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ’¸ ìš©ëˆ ì†Œë¹„ ê³„íš ë„ìš°ë¯¸ (Priority & Utility)</title>
  <style>
    body { font-family: 'ë§‘ì€ ê³ ë”•', sans-serif; margin: 40px; background: #f9f9f9; }
    h1 { color: #333; }
    input, select, button { padding: 8px; margin: 5px; }
    .item-input { margin-bottom: 10px; background: #fff; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .output { margin-top: 30px; padding: 20px; background: #fff; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .warning { color: #d9534f; }
  </style>
</head>
<body>

  <h1>ğŸ’¸ ìš©ëˆ ì†Œë¹„ ê³„íš ë„ìš°ë¯¸</h1>

  <label>ì´ë²ˆ ë‹¬ ìš©ëˆ (ì›):</label>
  <input type="number" id="totalMoney" /><br>

  <label>ë¹„ìƒê¸ˆ ë¹„ìœ¨ (%):</label>
  <input type="number" id="emergencyRate" /><br>

  <h3>ì‚¬ìš© í•­ëª© ì…ë ¥</h3>
  <div id="itemsContainer"></div>
  <button onclick="addItem()">+ í•­ëª© ì¶”ê°€</button>
  <button onclick="calculate()">ğŸ“Š ì†Œë¹„ ê³„íš ê³„ì‚°</button>

  <div class="output" id="result"></div>

  <script>
    function addItem() {
      const container = document.getElementById('itemsContainer');
      const div = document.createElement('div');
      div.className = 'item-input';
      div.innerHTML = `
        <label>í•­ëª© ì´ë¦„:</label>
        <input type="text" class="item-name" placeholder="ì˜ˆ: ì»¤í”¼" />
        <label>ì˜ˆì‚° (ì›”):</label>
        <input type="number" class="item-cost" placeholder="0" />
        <label>ì†Œë¹„ ì£¼ê¸°:</label>
        <select class="item-cycle">
          <option value="daily">ë§¤ì¼</option>
          <option value="weekly">ì£¼1íšŒ</option>
        </select>
        <label>ìš°ì„ ìˆœìœ„:</label>
        <select class="item-priority">
          <option value="1">1 - ë‚®ìŒ</option>
          <option value="2" selected>2 - ë³´í†µ</option>
          <option value="3">3 - ë§¤ìš° ì¤‘ìš”</option>
        </select>
      `;
      container.appendChild(div);
    }

    function calculate() {
      // 1) ê¸°ë³¸ ì…ë ¥ê°’ ê²€ì¦
      const T = parseInt(document.getElementById('totalMoney').value);
      const R = parseFloat(document.getElementById('emergencyRate').value);
      if (isNaN(T) || isNaN(R)) {
        alert("ìš©ëˆê³¼ ë¹„ìƒê¸ˆ ë¹„ìœ¨ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const emergency = Math.floor(T * (R / 100));
      const avail = T - emergency;

      // 2) í•­ëª© ìˆ˜ì§‘
      const names = document.getElementsByClassName('item-name');
      const costs = document.getElementsByClassName('item-cost');
      const cycles = document.getElementsByClassName('item-cycle');
      const pris   = document.getElementsByClassName('item-priority');

      let items = [], totalPlanned = 0, warnings = [];
      for (let i = 0; i < names.length; i++) {
        const name = names[i].value.trim();
        const cost = parseInt(costs[i].value);
        const cycle= cycles[i].value;
        const pri  = parseInt(pris[i].value);
        if (!name || isNaN(cost)) continue;
        items.push({ name, cost, cycle, pri });
        totalPlanned += cost;
        // í•œê³„íš¨ìš© ê²½ê³ : í•œ í•­ëª©ì´ ê°€ìš© ì˜ˆì‚°ì˜ 50% ì´ˆê³¼
        if (cost > avail * 0.5) {
          warnings.push(`âš ï¸ <strong>${name}</strong> í•­ëª©ì´ ì „ì²´ ì†Œë¹„ ì˜ˆì‚°ì˜ ${(cost/avail*100).toFixed(1)}%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤. ê· í˜•ì„ ê³ ë ¤í•˜ì„¸ìš”.`);
        }
      }
      if (items.length === 0) {
        alert("ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì†Œë¹„ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      // 3) ê²°ê³¼ ìƒì„±
      let html = `<h2>ğŸ“Š ì†Œë¹„ ê³„íš ê²°ê³¼</h2>`;
      html += `<p>ì´ ìš©ëˆ: ${T.toLocaleString()}ì› | ë¹„ìƒê¸ˆ: ${emergency.toLocaleString()}ì› | ê°€ìš© ì˜ˆì‚°: ${avail.toLocaleString()}ì›</p>`;

      // 4) ì˜ˆì‚° ì´ˆê³¼ ì‹œ ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ì¬ë¶„ë°°
      if (totalPlanned > avail) {
        html += `<p class="warning">âš ï¸ ì˜ˆì‚° ì´ˆê³¼! ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì¬ë¶„ë°°í•©ë‹ˆë‹¤.</p>`;
        const sumPri = items.reduce((s, it) => s + it.pri, 0);
        let redistributed = items.map(it => {
          return {
            ...it,
            cost: Math.floor(avail * (it.pri / sumPri))
          };
        });
        // ë‚¨ì€ ì†Œì•¡ì€ ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„ í•­ëª©ì— ì¶”ê°€
        const used = redistributed.reduce((s, it) => s + it.cost, 0);
        const diff = avail - used;
        if (diff > 0) {
          const top = redistributed.reduce((a,b) => b.pri > a.pri ? b : a);
          top.cost += diff;
        }
        items = redistributed;
      }

      // 5) ê²½ê³ ë¬¸êµ¬ ì‚½ì…
      if (warnings.length) {
        html += `<div class="warning"><p>ğŸ” ê²½ê³  ë° ì¡°ì–¸:</p><ul>`;
        warnings.forEach(w => html += `<li>${w}</li>`);
        html += `</ul></div>`;
      }

      // 6) í•­ëª©ë³„ ìƒì„¸ ì¶œë ¥
      html += `<ul>`;
      items.forEach(it => {
        let detail = it.cycle === 'daily'
          ? `â†’ í•˜ë£¨ë‹¹ ì•½ ${Math.floor(it.cost/30).toLocaleString()}ì›`
          : `â†’ 1íšŒë‹¹ ì•½ ${Math.floor(it.cost/4).toLocaleString()}ì›`;
        html += `<li>ğŸ“Œ ${it.name}: ${it.cost.toLocaleString()}ì›/ì›” (${it.cycle==='daily'?'ë§¤ì¼':'ì£¼1íšŒ'}) ${detail} [ìš°ì„ ìˆœìœ„:${it.pri}]</li>`;
      });
      html += `</ul>`;

      // 7) ë‚¨ì€ ì˜ˆì‚°
      const usedFinal = items.reduce((s, it) => s + it.cost, 0);
      html += `<p>ğŸ§® ë‚¨ì€ ì˜ˆì‚°: ${(avail - usedFinal).toLocaleString()}ì›</p>`;

      document.getElementById('result').innerHTML = html;
    }
  </script>

</body>
</html>